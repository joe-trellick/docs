<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Mesh Network | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/advanced/architecture/mesh-network"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mesh Network | Ditto"><meta data-react-helmet="true" name="description" content="When you use Ditto in your app you don’t have to think about how your devices will connect to each other. A device like an iPhone will build an interconnected mesh all on its own. As soon as you call tryStartSync() it fires up Bluetooth LE, scans for peers on the WiFi, and activates AWDL to create high-speed connections with nearby Apple devices—all this with one line of code."><meta data-react-helmet="true" property="og:description" content="When you use Ditto in your app you don’t have to think about how your devices will connect to each other. A device like an iPhone will build an interconnected mesh all on its own. As soon as you call tryStartSync() it fires up Bluetooth LE, scans for peers on the WiFi, and activates AWDL to create high-speed connections with nearby Apple devices—all this with one line of code."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/advanced/architecture/mesh-network"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/advanced/architecture/mesh-network" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/advanced/architecture/mesh-network" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.357422d5.css">
<link rel="preload" href="/assets/js/runtime~main.5a65d389.js" as="script">
<link rel="preload" href="/assets/js/main.5c0ef987.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Ditto</b></a><a href="https://www.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Samples Apps<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/getditto/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Advanced</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Platform Permissions</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Architecture</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/architecture/crdt">Conflict-Free Replicated Data Types (CRDTs)</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/advanced/architecture/mesh-network">Mesh Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/architecture/big-peer-internals">Big Peer Internals</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/certificate-security">Certificate Based Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/manual-network-transport-configuration">Manual Network Transport Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/monitoring-network-transports">Monitoring Transport Conditions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Mesh Network</h1></header><p>When you use Ditto in your app you don’t have to think about how your devices will connect to each other. A device like an iPhone will build an interconnected mesh all on its own. As soon as you call <code>tryStartSync()</code> it fires up Bluetooth LE, scans for peers on the WiFi, and activates AWDL to create high-speed connections with nearby Apple devices—all this with one line of code.</p><p>The mesh is an underlay for data sync. It operates independently of your queries and subscriptions. Data updates will propagate through the mesh automatically, <a href="/concepts/syncing-data">provided your subscriptions match</a>.</p><p>Ditto contains a number of algorithms to maintain an optimal mesh automatically, whether you have two devices or two thousand.</p><p>Many applications need to sync data with the cloud or an on-premises server. The Ditto SDK uses peer-to-peer and cloud connections simultaneously, turning your mesh global. This is as easy as setting your server’s URL.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="types-of-transports"></a>Types of Transports<a class="hash-link" href="#types-of-transports" title="Direct link to heading">#</a></h2><p>Ditto uses as many technologies as possible to communicate with other devices running your app. These different modes, such as Bluetooth Low Energy and LAN, are called <em>transports</em>.</p><p>Where possible Ditto will create a mesh using a mixture of transports. They offer different advantages and disadvantages. For example Bluetooth LE generally has a longer range but much lower bandwidth than WiFi. Therefore Ditto uses WiFi when it&#x27;s available, and falls back to Bluetooth when it isn’t.</p><p>Which transports are supported depends on what kind of device or SDK you are using. Some examples:</p><ul><li>A mobile phone can use <strong>Bluetooth LE</strong>, <strong>LAN</strong>, <strong>P2P WiFi</strong>, or a <strong>WebSocket</strong> connection to a cloud server.</li><li>A web application running in a browser can use <strong>WebSocket</strong>.</li><li>A Raspberry Pi can use <strong>Bluetooth LE</strong>, <strong>LAN</strong>, or <strong>WebSocket</strong>.</li></ul><p>Many transports will work automatically. Others like WebSocket require configuration. <a href="https://www.ditto.live/docs/references/network-transport-support" target="_blank" rel="noopener noreferrer">You can learn more about the supported transports and upcoming transports here</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="discovering-peers"></a>Discovering Peers<a class="hash-link" href="#discovering-peers" title="Direct link to heading">#</a></h2><p>When Ditto starts syncing it advertises itself on all enabled peer-to-peer transports. This advertisement is transmitted in different ways depending on the transport but it always involves two small pieces of information.</p><ul><li><strong>App ID Hash</strong> - A 32-bit hash of the app’s id.</li><li><strong>Announce</strong> - An encoded piece of text identifying an app session.</li></ul><p>All devices running the same app will have the same <em>App ID Hash</em> so they know they should connect to each other. In the rare event of a hash collision, Ditto may try to connect to a different app, but verification will fail and the connection will be cancelled immediately.</p><p>If you are monitoring network traffic you might come across a Ditto Announce. This is a Ditto-specific advertisement format which contains basic information about the device. This provides hints to Ditto so that it can construct a good mesh quickly and efficiently.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Q1RACGXmbwOgjGSGP771</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Q1                      Major protocol version: 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  RA                    Platform: Android</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    CGXmbwOg            32-bit Network ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            jGSGP771    Device name “SGP771”</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Network ID is randomised each time Ditto starts up. It enables peers to identify each other with high probability across all transports. If Peer A connects to Peer B over WiFi they know each other’s Network IDs, so Peer B can avoid creating a duplicate connection in the reverse direction.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="making-and-breaking-connections"></a>Making and Breaking Connections<a class="hash-link" href="#making-and-breaking-connections" title="Direct link to heading">#</a></h2><div class="d-flex justify-content-center"><div class="col-lg-8 py-4"><img src="./diagram2_new_peer.png"></div></div><p>When a user opens your app the first thing they will see is how quickly it syncs the latest information. Ditto understands this. When sync begins it uses all the transports aggressively to locate and connect to multiple potential peers concurrently. At the same time the existing peers will notice the newcomer’s arrival. If they have capacity they will also establish connections to the new device. Together, these processes ensure that a new peer is integrated into the mesh as quickly as possible.</p><p>After this initial burst Ditto must become more efficient. A mobile phone has a finite battery. Each extra LAN connection consumes more CPU time and more radio energy. Bluetooth is particularly constrained: devices can manage only a handful of concurrent connections and each connection can take several seconds to initiate. Therefore in larger meshes Ditto must limit the number of interconnections, and choose wisely.</p><p>At the same time Ditto must not have too <em>few</em> connections: otherwise islanding can occur, where different groups of devices in the same room are connected in individual clusters. If there is no connection between those groups they will not sync data with each other.</p><p>Ditto avoids islanding using two techniques, neither of which require central coordination. First, a reasonably dense mesh is preferred so that islanding is improbable. Second, a random churn means that devices will slowly change which peers they are connected to. This ensures that even if an island did form, it will likely only last a few seconds.</p><p>Next, certain optimisations are possible. Imagine there are two candidate peers for a Bluetooth connection but you only have capacity for one. If you are already connected to one of those peers via WiFi, then we should spend our Bluetooth connection on the other peer, to improve the diversity of the mesh.</p><p>Now, imagine the same scenario except we have capacity for two Bluetooth connections. This time we should connect to <em>both</em> of them. The Bluetooth connection where we have WiFi will sit idle for now, but if that WiFi connection goes away in the future then we can immediately failover to the pre-established Bluetooth connection. The user won&#x27;t even notice that anything happened.</p><p>Sounds complicated? Don’t worry about it. Everything described here is built into Ditto and your app will do this completely automatically. All you need to do is enable your transports and Ditto will make the best possible use of them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="using-bandwidth-intelligently"></a>Using Bandwidth Intelligently<a class="hash-link" href="#using-bandwidth-intelligently" title="Direct link to heading">#</a></h2><p>In smaller meshes Ditto will often create multiple connections to the same peer using different transports. This might look wasteful but it provides important performance benefits.</p><ol><li>The transports race against each other to establish a connection. As soon as we get the first one, data sync can begin. This means lower latency for initial sync.</li><li>The fastest connection is preferred to transfer data, so large updates sync as quickly as possible.</li><li>Unneeded slower connections like Bluetooth are left idle, which means the limited radio bandwidth is reserved for those peers that really need it.</li><li>If the fastest connection is lost, the next-best option is ready to go, reducing or eliminating the gap when no sync is possible.</li></ol><p>The seamless switching between transports relies on a Ditto component called the Multiplexer, which is described in detail in a <a href="https://www.ditto.live/blog/posts/the-new-network-multiplexer" target="_blank" rel="noopener noreferrer">blog post</a>.</p><p>As of Ditto v1.0 the Multiplexer uses one transport at a time with failover. In future versions this feature will enable more complex scenarios such as load-balancing across multiple routes and lossy transports.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="servers-and-the-cloud"></a>Servers and the Cloud<a class="hash-link" href="#servers-and-the-cloud" title="Direct link to heading">#</a></h2><p>In addition to peer-to-peer transports like Bluetooth, a cloud or on-prem server can be configured by specifying its URL. At Ditto we call a server like this a <em>Big Peer</em>, while regular SDKs are <em>Small Peers</em>.</p><p>Big Peers are especially important for users who want to use Ditto in a web browser, since web browsers have very limited peer-to-peer capabilities. The JavaScript SDK can be configured with the Big Peer that should be used for sync.</p><p>An SDK can sync directly with a Big Peer, or locally with Small Peers, or with both at the same time, acting as a bridge for devices that don’t have an internet connection.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuring-the-mesh"></a>Configuring the Mesh<a class="hash-link" href="#configuring-the-mesh" title="Direct link to heading">#</a></h2><p>Every Ditto SDK has a configuration structure called <code>TransportConfig</code>, which lives in the main <code>Ditto</code> object. If you don’t change the default configuration Ditto will enable all available peer-to-peer transports.</p><p>If you create a new <code>TransportConfig</code> it has three main sections:</p><ul><li><strong><code>peerToPeer</code></strong> - Contains properties for each type of transport. Set the <code>enabled</code>/<code>isEnabled</code> flag to <code>true</code> for each one that you want to use.</li><li><strong><code>connect</code></strong> - Servers to connect to: a list of WebSocket URLs.</li><li><strong><code>listen</code></strong> - Specialised configuration for making a Small Peer listen on a predictable port or act as a WebSocket server.</li></ul><p>Most apps will only need to configure the <code>peerToPeer</code> and WebSocket settings.</p><p>The <code>listen</code> parameters provide support for unusual scenarios such as web browser clients on fully offline networks. Please use these only as directed by Ditto. If misconfigured, the listener features could circumvent Ditto’s usual encryption and access control.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/getditto/docs/edit/master/docs/advanced/architecture/mesh-network.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/advanced/architecture/crdt"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Conflict-Free Replicated Data Types (CRDTs)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/advanced/architecture/big-peer-internals"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Big Peer Internals »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types-of-transports" class="table-of-contents__link">Types of Transports</a></li><li><a href="#discovering-peers" class="table-of-contents__link">Discovering Peers</a></li><li><a href="#making-and-breaking-connections" class="table-of-contents__link">Making and Breaking Connections</a></li><li><a href="#using-bandwidth-intelligently" class="table-of-contents__link">Using Bandwidth Intelligently</a></li><li><a href="#servers-and-the-cloud" class="table-of-contents__link">Servers and the Cloud</a></li><li><a href="#configuring-the-mesh" class="table-of-contents__link">Configuring the Mesh</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Quick Start</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Samples Apps<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5a65d389.js"></script>
<script src="/assets/js/main.5c0ef987.js"></script>
</body>
</html>